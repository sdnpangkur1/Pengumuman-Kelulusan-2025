<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <title>Admin Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://www.gstatic.com/firebasejs/7.20.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/7.20.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/7.20.0/firebase-database-compat.js"></script>
</head>
<body>

  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Admin Dashboard - Kelulusan SDN PANGKUR</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      background-color: #0D1B2A;
      background-image: 
        repeating-linear-gradient(
          45deg, 
          rgba(255,255,255,0.05), 
          rgba(255,255,255,0.05) 1px, 
          transparent 1px, 
          transparent 20px
        ),
        repeating-linear-gradient(
          -45deg, 
          rgba(255,255,255,0.05), 
          rgba(255,255,255,0.05) 1px, 
          transparent 1px, 
          transparent 20px
        );
      color: white;
      min-height: 100vh;
      padding: 2rem;
    }
    table {
      width: 100%;
      border-collapse: collapse;
    }
    th, td {
      border: 1px solid #FBBF24;
      padding: 0.5rem;
      text-align: center;
    }
    th {
      background-color: #FBBF24;
      color: #0D1B2A;
    }
    .btn {
      background-color: #FBBF24;
      color: #0D1B2A;
      font-weight: 600;
      padding: 0.25rem 0.75rem;
      border-radius: 0.375rem;
      cursor: pointer;
      margin: 0 0.15rem;
      transition: background-color 0.3s;
    }
    .btn:hover {
      background-color: #F59E0B;
    }
    #btn-logout {
      float: right;
      margin-bottom: 1rem;
      background-color: #DC2626;
      color: white;
    }
    #btn-logout:hover {
      background-color: #B91C1C;
    }
  </style>
</head>
<body>
  <h1 class="text-yellow-400 text-3xl font-bold mb-6 text-center">
    Admin Dashboard - Kelulusan SDN PANGKUR 1 & 2 Tahun 2025
  </h1>

  <button id="btn-logout" class="btn">Logout</button>
  <button id="btn-tambah" class="btn mb-4">Tambah Data Siswa</button>

  <table>
    <thead>
      <tr>
        <th>Nama</th>
        <th>NISN</th>
        <th>Tanggal Lahir (DDMMYYYY)</th>
        <th>Nilai Akhir</th>
        <th>Status Lulus</th>
        <th>Aksi</th>
      </tr>
    </thead>
    <tbody id="tbody-siswa"></tbody>
  </table>

  <!-- Pengaturan Waktu Countdown -->
  <div class="bg-white text-gray-900 p-4 rounded shadow mt-8 max-w-md">
    <h2 class="text-lg font-bold mb-2">Pengaturan Waktu Countdown</h2>
    <form id="form-waktu">
      <label class="block mb-1 font-medium">Waktu Buka Pengumuman:</label>
      <input type="datetime-local" id="inputWaktu" required class="w-full p-2 rounded border mb-4" />
      <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">Simpan Waktu</button>
    </form>
  </div>

  <!-- Script untuk pengelolaan data dan countdown -->
  <script>
    // Cek login admin
    if (localStorage.getItem("adminLoggedIn") !== "true") {
      alert("Anda harus login sebagai admin terlebih dahulu.");
      window.location.href = "index.html";
    }

    function getDataSiswa() {
      return JSON.parse(localStorage.getItem("dataSiswa")) || [];
    }
    function simpanDataSiswa(data) {
      localStorage.setItem("dataSiswa", JSON.stringify(data));
    }

    // Render tabel siswa
    function renderTabel() {
      const tbody = document.getElementById("tbody-siswa");
      tbody.innerHTML = "";
      const dataSiswa = getDataSiswa();

      if (dataSiswa.length === 0) {
        tbody.innerHTML = `<tr><td colspan="6" class="text-center">Belum ada data siswa.</td></tr>`;
        return;
      }

      dataSiswa.forEach((siswa, idx) => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td class="capitalize">${siswa.nama}</td>
          <td>${siswa.nisn}</td>
          <td>${siswa.ttl}</td>
          <td>${siswa.nilai}</td>
          <td>${siswa.lulus ? "LULUS" : "TIDAK LULUS"}</td>
          <td>
            <button class="btn edit" data-idx="${idx}">Edit</button>
            <button class="btn bg-red-600 hover:bg-red-500 text-white delete" data-idx="${idx}">Hapus</button>
          </td>
        `;
        tbody.appendChild(tr);
      });

      // Event edit
      document.querySelectorAll(".edit").forEach(btn => {
        btn.addEventListener("click", e => {
          const idx = e.target.getAttribute("data-idx");
          window.location.href = `form-siswa.html?edit=${idx}`;
        });
      });

      // Event hapus
      document.querySelectorAll(".delete").forEach(btn => {
        btn.addEventListener("click", e => {
          const idx = e.target.getAttribute("data-idx");
          if (confirm("Yakin ingin menghapus data ini?")) {
            let data = getDataSiswa();
            data.splice(idx, 1);
            simpanDataSiswa(data);
            renderTabel();
          }
        });
      });
    }

    document.getElementById("btn-tambah").addEventListener("click", () => {
      window.location.href = "form-siswa.html";
    });

    document.getElementById("btn-logout").addEventListener("click", () => {
      localStorage.removeItem("adminLoggedIn");
      window.location.href = "index.html";
    });

    renderTabel();

    // Script pengaturan waktu countdown
    const inputWaktu = document.getElementById('inputWaktu');
    const waktuTersimpan = localStorage.getItem("waktuCountdown");
    if (waktuTersimpan) {
      inputWaktu.value = new Date(waktuTersimpan).toISOString().slice(0, 16);
    }

    document.getElementById("form-waktu").addEventListener("submit", function (e) {
      e.preventDefault();
      const waktuBaru = new Date(inputWaktu.value).toISOString();
      localStorage.setItem("waktuCountdown", waktuBaru);
      alert("Waktu pengumuman berhasil diperbarui!");
    });
  </script>
</body>
</html>
